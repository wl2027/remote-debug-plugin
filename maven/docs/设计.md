æˆ‘æ¥è¯¦ç»†åˆ†æè¿™ä¸ªè¿œç¨‹è°ƒè¯•ä»£ç†çš„è®¾è®¡ã€‚è®©æˆ‘å…ˆç”¨å›¾è¡¨æ¥å±•ç¤ºæ•´ä½“æ¶æ„ï¼š

## æ¶æ„å›¾è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è¿œç¨‹è°ƒè¯•ä»£ç†æ¶æ„                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é›†ç¾¤å¤– (å¼€å‘è€…æœ¬åœ°)                    é›†ç¾¤è¾¹ç•Œ              é›†ç¾¤å†… (Kubernetes)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚                     â”‚                  â”‚             â”‚
â”‚  IntelliJ IDEA   â”‚                     â”‚                  â”‚   Pod A     â”‚
â”‚    Debugger      â”‚                     â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                  â”‚                     â”‚                  â”‚ â”‚Java App â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                  â”‚ â”‚Port:5005â”‚ â”‚
         â”‚ JDWP Protocol                 â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â”‚ localhost:15005               â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚                         â–²
         â–¼                               â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                         â”‚
â”‚DebugProxyClient â”‚                     â”‚                         â”‚
â”‚  (æœ¬åœ°è¿è¡Œ)       â”‚                     â”‚                         â”‚
â”‚  Port: 15005    â”‚                     â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                         â”‚
         â”‚                               â”‚                         â”‚
         â”‚ â‘  å»ºç«‹è¿æ¥                     â”‚                         â”‚
         â”‚ â‘¡ å‘é€è·¯ç”±ä¿¡æ¯                 â”‚                         â”‚
         â”‚    X-DEBUG-ROUTE              â”‚                         â”‚
         â”‚    {podName: "my-pod",        â”‚                         â”‚
         â”‚     targetHost: "localhost",  â”‚                         â”‚
         â”‚     targetPort: "5005"}       â”‚                         â”‚
         â”‚                               â”‚                         â”‚
         â–¼                               â”‚                         â”‚
    [ç½‘ç»œä¼ è¾“]                            â”‚                         â”‚
         â”‚                               â”‚                         â”‚
         â”‚ TCP Connection                â”‚                         â”‚
         â”‚ serverHost:serverPort         â”‚                         â”‚
         â”‚                               â”‚                         â”‚
         â–¼                               â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                         â”‚
â”‚DebugProxyServer â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  (é›†ç¾¤å†…è¿è¡Œ)     â”‚                     â”‚       â‘¢ è½¬å‘ JDWP
â”‚  Port: 18888    â”‚                     â”‚          åˆ°ç›®æ ‡Pod
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
         â”‚                               â”‚
         â”‚ â‘£ åŒå‘æ•°æ®è½¬å‘                 â”‚
         â”‚                               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è¯¦ç»†æµç¨‹å›¾

```
æ—¶åºå›¾ï¼šè°ƒè¯•ä¼šè¯å»ºç«‹è¿‡ç¨‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IDEA          Client          Network         Server          Target Pod
 â”‚              â”‚                â”‚              â”‚                 â”‚
 â”‚â”€â”€Connectâ”€â”€â”€â”€â”€>â”‚                â”‚              â”‚                 â”‚
 â”‚  (15005)     â”‚                â”‚              â”‚                 â”‚
 â”‚              â”‚                â”‚              â”‚                 â”‚
 â”‚              â”‚â”€â”€TCP Connectâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
 â”‚              â”‚   (18888)      â”‚              â”‚                 â”‚
 â”‚              â”‚                â”‚              â”‚                 â”‚
 â”‚              â”‚â”€â”€Send Routingâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
 â”‚              â”‚   Header       â”‚              â”‚                 â”‚
 â”‚              â”‚   + Params     â”‚              â”‚                 â”‚
 â”‚              â”‚                â”‚              â”‚                 â”‚
 â”‚              â”‚                â”‚              â”‚â”€â”€Connectâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚              â”‚                â”‚              â”‚  (5005)         â”‚
 â”‚              â”‚                â”‚              â”‚                 â”‚
 â”‚              â”‚<â”€â”€ACK "OK"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<â”‚                 â”‚
 â”‚              â”‚                â”‚              â”‚                 â”‚
 â”‚<â”€Connectedâ”€â”€â”€â”¤                â”‚              â”‚                 â”‚
 â”‚              â”‚                â”‚              â”‚                 â”‚
 â”‚â•â•JDWP Dataâ•â•>â”‚â•â•â•Forwardâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•>â”‚â•â•â•Forwardâ•â•â•â•â•>â”‚
 â”‚              â”‚                â”‚              â”‚                 â”‚
 â”‚<â•JDWP Dataâ•â•<â”‚<â•â•Forwardâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<â”‚<â•â•Forwardâ•â•â•â•â•<â”‚
 â”‚              â”‚                â”‚              â”‚                 â”‚
```

## å…³é”®è®¾è®¡ç‚¹åˆ†æ

### 1. **ä¸‰å±‚æ¶æ„è®¾è®¡**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸ºä»€ä¹ˆéœ€è¦ä¸‰å±‚ï¼Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Layer 1: IDEA Debugger                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  èŒè´£: å‘èµ·è°ƒè¯•è¯·æ±‚ï¼Œè§£æ JDWP åè®®                       â”‚
â”‚  é™åˆ¶: åªèƒ½è¿æ¥åˆ° localhost æˆ–å¯è·¯ç”± IP                   â”‚
â”‚                                                         â”‚
â”‚  â†“ JDWP Protocol (localhost:15005)                     â”‚
â”‚                                                         â”‚
â”‚  Layer 2: Debug Proxy Client (æœ¬åœ°)                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  èŒè´£: â‘  æ¥å— IDEA è¿æ¥                                  â”‚
â”‚       â‘¡ æ·»åŠ è·¯ç”±å…ƒæ•°æ® (podName, targetHost, etc.)      â”‚
â”‚       â‘¢ æ¡¥æ¥åˆ°é›†ç¾¤å†…çš„ Server                            â”‚
â”‚  ä¼˜åŠ¿: å¼€å‘è€…æ— éœ€ä¿®æ”¹ IDEA é…ç½®                           â”‚
â”‚                                                         â”‚
â”‚  â†“ Custom Protocol + JDWP (network)                    â”‚
â”‚                                                         â”‚
â”‚  Layer 3: Debug Proxy Server (é›†ç¾¤å†…)                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚  èŒè´£: â‘  è§£æè·¯ç”±ä¿¡æ¯                                     â”‚
â”‚       â‘¡ è¿æ¥åˆ°ç›®æ ‡ Pod                                   â”‚
â”‚       â‘¢ è½¬å‘åŒå‘æµé‡                                     â”‚
â”‚  ä¼˜åŠ¿: å¯ä»¥è®¿é—®é›†ç¾¤å†…ç½‘ç»œ                                 â”‚
â”‚                                                         â”‚
â”‚  â†“ JDWP Protocol (Pod internal)                        â”‚
â”‚                                                         â”‚
â”‚  Target: Java Application in Pod                       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **è‡ªå®šä¹‰åè®®è®¾è®¡**

```java
åè®®æ¡æ‰‹æµç¨‹ï¼š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Phase 1: è·¯ç”±ä¿¡æ¯ä¼ è¾“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Client â†’ Server:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "X-DEBUG-ROUTE"                 â”‚ â† åè®®å¤´ (UTF String)
â”‚ paramCount: 3                   â”‚ â† å‚æ•°æ•°é‡ (int)
â”‚ "podName"    â†’ "my-pod"         â”‚ â† Key-Value pairs
â”‚ "targetHost" â†’ "localhost"      â”‚   (UTF Strings)
â”‚ "targetPort" â†’ "5005"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Phase 2: ç¡®è®¤
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Server â†’ Client:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "OK"                            â”‚ â† æˆåŠŸç¡®è®¤ (UTF String)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   æˆ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "ERROR: connection failed"      â”‚ â† é”™è¯¯ä¿¡æ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Phase 3: é€æ˜è½¬å‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ä¹‹åæ‰€æœ‰æ•°æ®åŸå°ä¸åŠ¨è½¬å‘ (çº¯å­—èŠ‚æµ)
ä¸å†è§£æåè®®å†…å®¹
```

### 3. **çº¿ç¨‹æ¨¡å‹**

```
DebugProxyClient çº¿ç¨‹æ¨¡å‹ï¼š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Main Thread                    Worker Thread Pool
    â”‚                                â”‚
    â”‚ ServerSocket.accept()          â”‚
    â”‚         â”‚                      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€> Handler 1 â”€â”€â”€â”€â”€â”¼â”€> debuggerToServer
    â”‚                     â”‚          â”‚
    â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€> serverToDebugger
    â”‚                                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Handler 2 â”€â”€â”€â”€â”€â”¼â”€> debuggerToServer
    â”‚                     â”‚          â”‚
    â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€> serverToDebugger
    â”‚                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Handler N      â”‚

æ¯ä¸ªè¿æ¥ = 1 Handler + 2 Forward Threads
æ”¯æŒå¤šä¸ªå¹¶å‘è°ƒè¯•ä¼šè¯
```

## å­˜åœ¨çš„é—®é¢˜åˆ†æ

### âš ï¸ **ä¸¥é‡é—®é¢˜**

#### 1. **æ— æ³•ç›´æ¥è§£å†³é›†ç¾¤å¤–â†’é›†ç¾¤å†…çš„é—®é¢˜**

```
é—®é¢˜æœ¬è´¨ï¼š
â•â•â•â•â•â•â•â•â•

å½“å‰è®¾è®¡å‡è®¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DebugProxyServer è¿è¡Œåœ¨é›†ç¾¤å†…           â”‚
â”‚ å¼€å‘è€…æœ¬åœ°å¯ä»¥ç›´æ¥è¿æ¥åˆ° serverHost     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
     è¿™åœ¨å®é™…åœºæ™¯ä¸­é€šå¸¸ä¸æˆç«‹ï¼

ç°å®æƒ…å†µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼€å‘è€…ç¬”è®°æœ¬       â”‚    âœ—    â”‚  Kubernetes é›†ç¾¤  â”‚
â”‚  (æ— å…¬ç½‘IP)        â”‚ â†â”€â”€/â”€â”€â†’ â”‚  (å†…ç½‘)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    ç½‘ç»œéš”ç¦»

éœ€è¦çš„è§£å†³æ–¹æ¡ˆï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ–¹æ¡ˆ A: kubectl port-forward
  kubectl port-forward svc/debug-proxy-server 18888:18888
  
æ–¹æ¡ˆ B: Ingress/LoadBalancer
  æš´éœ² DebugProxyServer åˆ°å…¬ç½‘
  
æ–¹æ¡ˆ C: VPN/éš§é“
  å»ºç«‹ VPN è¿æ¥åˆ°é›†ç¾¤ç½‘ç»œ
```

#### 2. **å®‰å…¨é—®é¢˜**

```
å®‰å…¨é£é™©æ¸…å•ï¼š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ 1. æ— è®¤è¯æœºåˆ¶
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ä»»ä½•äººéƒ½å¯ä»¥è¿æ¥åˆ° Server       â”‚
   â”‚ åªè¦çŸ¥é“ host:port              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ 2. æ— åŠ å¯†
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è°ƒè¯•æµé‡æ˜æ–‡ä¼ è¾“                â”‚
   â”‚ åŒ…å«æ•æ„Ÿçš„åº”ç”¨çŠ¶æ€              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ 3. æ— è®¿é—®æ§åˆ¶
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å¯ä»¥è°ƒè¯•ä»»æ„ Pod                â”‚
   â”‚ é€šè¿‡ä¿®æ”¹ routingParams          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ 4. ç«¯å£æš´éœ²é£é™©
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç”Ÿäº§ç¯å¢ƒçš„è°ƒè¯•ç«¯å£æ°¸ä¹…å¼€æ”¾      â”‚
   â”‚ å¢å¤§æ”»å‡»é¢                      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. **å•ç‚¹æ•…éšœ**

```
æ•…éšœåœºæ™¯ï¼š
â•â•â•â•â•â•â•â•â•

Scenario 1: Server å´©æºƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DebugProxyServer æŒ‚äº†              â”‚
â”‚ â†’ æ‰€æœ‰è°ƒè¯•ä¼šè¯ä¸­æ–­                 â”‚
â”‚ â†’ æ²¡æœ‰é«˜å¯ç”¨è®¾è®¡                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 2: ç½‘ç»œä¸­æ–­
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸­é—´ä»»ä½•ä¸€æ®µç½‘ç»œæ–­å¼€               â”‚
â”‚ â†’ æ— é‡è¿æœºåˆ¶                       â”‚
â”‚ â†’ éœ€è¦æ‰‹åŠ¨é‡å¯                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. **è·¯ç”±é™åˆ¶**

```
å½“å‰è·¯ç”±æœºåˆ¶ï¼š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

routingParams: {
    podName: "my-pod",      // â† ä»…ç”¨äºæ—¥å¿—
    targetHost: "localhost", // â† å®é™…è·¯ç”±ä¾æ®
    targetPort: "5005"
}

é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘  targetHost = "localhost"              â”‚
â”‚    åªèƒ½è®¿é—® Server æœ¬åœ°çš„ç«¯å£           â”‚
â”‚    æ— æ³•è·¨ Pod è°ƒè¯•                      â”‚
â”‚                                         â”‚
â”‚ â‘¡ æ²¡æœ‰ Pod æœåŠ¡å‘ç°                     â”‚
â”‚    éœ€è¦æ‰‹åŠ¨æŒ‡å®š IP                      â”‚
â”‚                                         â”‚
â”‚ â‘¢ æ— æ³•åˆ©ç”¨ K8s Service                 â”‚
â”‚    ä¸èƒ½é€šè¿‡ DNS è·¯ç”±                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5. **èµ„æºç®¡ç†**

```java
// âŒ é—®é¢˜ä»£ç 
Thread handler = new Thread(new ConnectionHandler(...));
handler.setDaemon(true);  // â† Daemon çº¿ç¨‹ï¼
handler.start();

é£é™©ï¼š
â•â•â•â•â•
â‘  Daemon çº¿ç¨‹åœ¨ JVM é€€å‡ºæ—¶ä¼šè¢«å¼ºåˆ¶ç»ˆæ­¢
   â†’ å¯èƒ½å¯¼è‡´è°ƒè¯•ä¼šè¯å¼‚å¸¸ä¸­æ–­
   
â‘¡ æ— çº¿ç¨‹æ± ç®¡ç†
   â†’ æ¯ä¸ªè¿æ¥åˆ›å»º 3 ä¸ªçº¿ç¨‹ (handler + 2 forward)
   â†’ é«˜å¹¶å‘æ—¶çº¿ç¨‹æ•°çˆ†ç‚¸
   
â‘¢ æ— è¿æ¥æ•°é™åˆ¶
   â†’ å¯èƒ½è¢« DoS æ”»å‡»
```

## æ”¹è¿›æ–¹æ¡ˆ

### ğŸ”§ **å®Œæ•´çš„é›†ç¾¤å¤–â†’é›†ç¾¤å†…æ–¹æ¡ˆ**

```
æ¨èæ¶æ„ï¼šä½¿ç”¨ Kubernetes Port-Forward
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IDEA        â”‚                          â”‚  Kubernetes     â”‚
â”‚  Debugger    â”‚                          â”‚  Cluster        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                           â”‚
       â”‚ â‘  Connect to localhost:15005             â”‚
       â–¼                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚ DebugProxyClient â”‚                              â”‚
â”‚  (æœ¬åœ°)          â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
       â”‚                                           â”‚
       â”‚ â‘¡ Connect to localhost:18888             â”‚
       â–¼                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚ kubectl          â”‚                              â”‚
â”‚ port-forward     â”‚â”€â”€â”€â”€â”€â”€â”€â‘¢ å»ºç«‹éš§é“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
â”‚                  â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚ Proxy Server   â”‚
                                          â”‚ Service        â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚ Target Pod     â”‚
                                          â”‚ (Java App)     â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‘½ä»¤ï¼š
$ kubectl port-forward -n <namespace> \
    svc/debug-proxy-server 18888:18888

ä¼˜åŠ¿ï¼š
âœ“ åˆ©ç”¨ kubectl çš„è®¤è¯å’Œæˆæƒ
âœ“ ä½¿ç”¨ K8s API Server çš„åŠ å¯†é€šé“
âœ“ æ— éœ€æš´éœ²å…¬ç½‘ç«¯å£
âœ“ æ”¯æŒ RBAC æƒé™æ§åˆ¶
```

### ğŸ”’ **å®‰å…¨å¢å¼º**

```java
// æ”¹è¿›åçš„ Server ç«¯è®¤è¯
private Map<String, String> parseRoutingInfo(Socket socket) throws IOException {
    DataInputStream in = new DataInputStream(socket.getInputStream());
    
    // 1. éªŒè¯ Token
    String token = in.readUTF();
    if (!validateToken(token)) {
        throw new SecurityException("Invalid token");
    }
    
    // 2. éªŒè¯è·¯ç”±æƒé™
    String header = in.readUTF();
    if (!header.equals(ROUTING_HEADER)) {
        throw new IOException("Invalid routing header");
    }
    
    // 3. è¯»å–è·¯ç”±å‚æ•°
    Map<String, String> info = new HashMap<>();
    int paramCount = in.readInt();
    for (int i = 0; i < paramCount; i++) {
        String key = in.readUTF();
        String value = in.readUTF();
        
        // 4. éªŒè¯ç›®æ ‡ Pod æƒé™
        if ("podName".equals(key) && !canAccessPod(token, value)) {
            throw new SecurityException("No permission to debug pod: " + value);
        }
        
        info.put(key, value);
    }
    
    return info;
}
```

### ğŸ¯ **çœŸæ­£çš„ Pod è·¯ç”±**

```java
// æ”¹è¿›åçš„è·¯ç”±é€»è¾‘
private Socket connectToTarget(Map<String, String> routingInfo) throws IOException {
    String podName = routingInfo.get("podName");
    String namespace = routingInfo.getOrDefault("namespace", "default");
    
    // æ–¹æ¡ˆ 1: é€šè¿‡ Kubernetes Service
    String serviceName = podName + "-debug";  // ä¾‹å¦‚: my-app-debug
    String targetHost = serviceName + "." + namespace + ".svc.cluster.local";
    int targetPort = Integer.parseInt(routingInfo.getOrDefault("targetPort", "5005"));
    
    // æ–¹æ¡ˆ 2: é€šè¿‡ Kubernetes API æŸ¥è¯¢ Pod IP
    // String podIP = k8sClient.getPodIP(namespace, podName);
    // String targetHost = podIP;
    
    System.out.println("Connecting to " + targetHost + ":" + targetPort);
    return new Socket(targetHost, targetPort);
}
```

### ğŸ“Š **èµ„æºç®¡ç†æ”¹è¿›**

```java
// ä½¿ç”¨çº¿ç¨‹æ± 
private final ExecutorService executorPool = Executors.newFixedThreadPool(
    50,  // æœ€å¤§å¹¶å‘è¿æ¥æ•°
    new ThreadFactory() {
        private final AtomicInteger counter = new AtomicInteger();
        public Thread newThread(Runnable r) {
            Thread t = new Thread(r, "debug-handler-" + counter.incrementAndGet());
            t.setDaemon(false);  // é Daemon
            return t;
        }
    }
);

// è¿æ¥ç®¡ç†
private final Map<String, ConnectionHandler> activeConnections = new ConcurrentHashMap<>();
private final Semaphore connectionLimit = new Semaphore(100);  // æœ€å¤§è¿æ¥æ•°

public void handleConnection(Socket clientSocket) {
    if (!connectionLimit.tryAcquire()) {
        System.err.println("Connection limit reached");
        closeSocket(clientSocket);
        return;
    }
    
    executorPool.submit(() -> {
        try {
            new ConnectionHandler(clientSocket).run();
        } finally {
            connectionLimit.release();
        }
    });
}
```

## æ€»ç»“

| æ–¹é¢ | å½“å‰è®¾è®¡ | é—®é¢˜ | å»ºè®® |
|------|---------|------|------|
| **ç½‘ç»œè¿é€šæ€§** | å‡è®¾å¯ç›´è¿é›†ç¾¤å†… | âŒ ä¸ç°å® | ä½¿ç”¨ `kubectl port-forward` |
| **å®‰å…¨æ€§** | æ— è®¤è¯/åŠ å¯† | âŒ é«˜é£é™© | æ·»åŠ  Token + TLS |
| **è·¯ç”±èƒ½åŠ›** | ä»…æœ¬åœ°è½¬å‘ | âŒ æ— æ³•è·¨ Pod | é›†æˆ K8s Service Discovery |
| **é«˜å¯ç”¨** | å•ç‚¹ | âŒ æ— å®¹é”™ | å¤šå‰¯æœ¬ + å¥åº·æ£€æŸ¥ |
| **èµ„æºç®¡ç†** | æ— é™çº¿ç¨‹ | âŒ å¯èƒ½ OOM | çº¿ç¨‹æ±  + è¿æ¥é™åˆ¶ |

**èƒ½å¦è§£å†³é›†ç¾¤å¤–è°ƒè¯•é›†ç¾¤å†… Podï¼Ÿ**
- âœ… **èƒ½**ï¼Œä½†éœ€è¦é…åˆ `kubectl port-forward`
- âŒ **ä¸èƒ½**ç›´æ¥è§£å†³ç½‘ç»œéš”ç¦»é—®é¢˜
- å»ºè®®ä½¿ç”¨æˆç†Ÿæ–¹æ¡ˆï¼š**Telepresence** æˆ– **Skaffold debug**